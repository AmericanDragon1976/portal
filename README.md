portalproxy  -- Traffic director 
===========

The proxy portal of the portal does the following in this order upon startup: 1) read the config file, and parse each service. 2) connects to each monitor that is configured as part of a service. 3) ask the monitor who to proxy inbound connections to. 4) create listen acceptors for each service in the config file. 5) endlesly proxies connections. 6) endlessly listens for updates from the monitor(s). At it's most basic the portal proxy is a traffic director. It connects to services, accepts connections from clients to those services and passes information back and forth between them. If the monitor sends it a new address for a service it will disconnect all clients and update its address for that service, if the service goes down and needs rerouted to a backup, so that when clients attempt to reconnect it will automatically send them to the new correct address. 

The portal proxy is one piece of a three part project.  The three parts are the portal proxy, the monitor, and the agent. The proxy requires a command line start in the form portal-proxy flags path/to/config.txt the only flag included at this time is the -C flag which doesn't actually do anything at this time. However it was included, because of future advances where more than one flag will be avaliable and do different things. For the time being you could simple comment out the code makeing it requried without affecting the rest of the program. The proxy will take the path to the config.txt file, open the file and parse the file. the file must be in the format of three lines per service that it is to proxy. The first line must have the word service followed by the name of the service, the second line must have the word monitor followed by an ip address and socket number in the form a.b.c.d:socket#, the third line must the word monitor followed by an ip addres and socket number in the same format. The name following service is tracked as the name of the service in the program and is used to verify connections with and information recived from the monitor. The address that follows the word listen is the address where the proxy will listen for clients wanting access to that service. The address following monitor is the address where the proxy will atttempt to connect to the monitor. As soon as the config.txt file is parsed the proxy will connect to the monitor for each service on the list, send the name of the service to the monitor and start listening to the monitor on that connection. The monitor should respond with the service name and the address to connect to that service. It doesn't matter if the monitor is one program accepting multiple connections or a seperate program for each service to be connected to. I must recive the inicial contact as the name of the service, rather it doesn't any checking to verify that the correct service is requested on that connection does not matter to the porxy, but the proxy will use the name sent back to it to verity that it as the address and service correctly, and will not connect clients to that service if they don't match. 

After connecting to the monitors it opens listeners for new connections on each of the address for clients and associates any clients who connect on that address to the service that is associated with that address. The services their current connection address and a list of client service pairs of bufferevents are stored in each node of a linked list. The client service pairs are stored in the node as their own linked list. Messages from the monitor are always in the form of service name and address pairs. If the address is the same as the one already connected to or the name of the service doesn't match the one assigned to that connection the input is ignored. 

If an attempt is made to pass information from client to service or from service to client and the other side is not connected then both sides are disconnected and all memory allocated for maintaining and tracking that connection is freed. 